% ==============================
% Math
% ==============================
\usepackage{mathtools}

% ==============================
% Chapter headers
% ==============================
% Chapter label
\renewcommand*{\chapterformat}{%
  \centering\Huge CHAPTER~\thechapter
}
% Chapter title
\makeatletter
\renewcommand*{\chapterlinesformat}[3]{%
  \begingroup
    \edef\ltmp{\detokenize{#2}}%
    \ifx\ltmp\@empty
      % Unnumbered chapters: 
      % thin rule + centered uppercase title
      \rule{\textwidth}{2pt}\par\nointerlineskip
      \vspace{1ex}%
      \centering\Huge\MakeUppercase{#3}\par
      \vspace{4ex}%
    \else
      % Numbered chapters:
      % thick rule, thin rule, label, thin rule, title
      \rule{\textwidth}{8pt}\par\nointerlineskip
      \vspace{0.3ex}%
      \rule{\textwidth}{2pt}\par\nointerlineskip
      \vspace{1ex}%
      #2\par\nointerlineskip
      \vspace{1ex}%
      \rule{\textwidth}{2pt}\par\nointerlineskip
      \vspace{1ex}%
      \centering\Huge\MakeUppercase{#3}\par
      \vspace{4ex}%
    \fi
  \endgroup
}
\makeatother

% ==============================
% Page headers
% ==============================
\usepackage{scrlayer-scrpage}        % KOMA: header/footer control
\clearpairofpagestyles               % remove default styles
\automark[chapter]{chapter}          % set running head from chapter titles
\setkomafont{pagehead}{\normalfont\normalsize} % header font style

\ihead{\pagemark}                    % page number on inner side
\ohead{\MakeUppercase{\headmark}}    % chapter title on outer side (uppercase)

\renewcommand*\chaptermarkformat{%   % how chapter marks are printed
  \MakeUppercase{\chaptername~\thechapter\autodot\enskip}%
}

% ==============================
% Index
% ==============================
\usepackage{imakeidx}
\makeindex[
    intoc=true, 
    columns=2, 
    columnseprule=true, 
    options= -s latex/indexstyle.ist
]